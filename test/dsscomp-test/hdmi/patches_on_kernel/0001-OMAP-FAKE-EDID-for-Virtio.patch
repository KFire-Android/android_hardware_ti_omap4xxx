From 0c49890a843f0cd488fb02a667dba261bb4dfe21 Mon Sep 17 00:00:00 2001
From: Muralidhar Dixit <murali.dixit@ti.com>
Date: Fri, 16 Dec 2011 12:29:29 +0530
Subject: [PATCH 1/2] OMAP: HDMI: Fake EDID for virtio

---
 drivers/video/omap2/dss/hdmi.c |   25 +++++++++++++++++++++++++
 1 files changed, 25 insertions(+), 0 deletions(-)

diff --git a/drivers/video/omap2/dss/hdmi.c b/drivers/video/omap2/dss/hdmi.c
index 724c778..d5767e4 100644
--- a/drivers/video/omap2/dss/hdmi.c
+++ b/drivers/video/omap2/dss/hdmi.c
@@ -65,6 +65,26 @@
 #define HDMI_DEFAULT_REGN 16
 #define HDMI_DEFAULT_REGM2 1
 
+#ifdef  CONFIG_OMAP5_VIRTIO
+u8 local_edid[256]={
+	0x00,0xff,0xff,0xff,0xff,0xff,0xff,0x00,0x4c,0x2d,0xc0,0x07,0x00,0x00,0x00,0x00,
+	0x2e,0x14,0x01,0x03,0x80,0x10,0x09,0x78,0x0a,0xee,0x91,0xa3,0x54,0x4c,0x99,0x26,
+	0x0f,0x50,0x54,0xbd,0xef,0x80,0x71,0x4f,0x81,0x00,0x81,0x40,0x81,0x80,0x95,0x00,
+	0x95,0x0f,0xb3,0x00,0xa9,0x40,0x02,0x3a,0x80,0x18,0x71,0x38,0x2d,0x40,0x58,0x2c,
+	0x45,0x00,0xa0,0x5a,0x00,0x00,0x00,0x1e,0x66,0x21,0x50,0xb0,0x51,0x00,0x1b,0x30,
+	0x40,0x70,0x36,0x00,0xa0,0x5a,0x00,0x00,0x00,0x1e,0x00,0x00,0x00,0xfd,0x00,0x18,
+	0x4b,0x1a,0x51,0x17,0x00,0x0a,0x20,0x20,0x20,0x20,0x20,0x20,0x00,0x00,0x00,0xfc,
+	0x00,0x53,0x41,0x4d,0x53,0x55,0x4e,0x47,0x0a,0x20,0x20,0x20,0x20,0x20,0x01,0xd0,
+	0x02,0x03,0x23,0xf1,0x4b,0x90,0x1f,0x04,0x13,0x05,0x14,0x03,0x12,0x20,0x21,0x22,
+	0x23,0x09,0x07,0x07,0x83,0x01,0x00,0x00,0xe2,0x00,0x0f,0x67,0x03,0x0c,0x00,0x10,
+	0x00,0xb8,0x2d,0x01,0x1d,0x00,0x72,0x51,0xd0,0x1e,0x20,0x6e,0x28,0x55,0x00,0xa0,
+	0x5a,0x00,0x00,0x00,0x1e,0x01,0x1d,0x00,0xbc,0x52,0xd0,0x1e,0x20,0xb8,0x28,0x55,
+	0x40,0xa0,0x5a,0x00,0x00,0x00,0x1e,0x01,0x1d,0x80,0x18,0x71,0x1c,0x16,0x20,0x58,
+	0x2c,0x25,0x00,0xa0,0x5a,0x00,0x00,0x00,0x9e,0x01,0x1d,0x80,0xd0,0x72,0x1c,0x16,
+	0x20,0x10,0x2c,0x25,0x80,0xa0,0x5a,0x00,0x00,0x00,0x9e,0x00,0x00,0x00,0x00,0x00,
+	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0d};
+
+#endif
 
 
 /*#define GPIO_HDMI_HPD		63*/
@@ -242,6 +262,7 @@ u8 *hdmi_read_edid(struct omap_video_timings *dp)
 
 	memset(hdmi.edid, 0, HDMI_EDID_MAX_LENGTH);
 
+#ifndef CONFIG_OMAP5_VIRTIO
         if (!hdmi.edid_set)
                 ret = hdmi.ip_data.ops->read_edid(&hdmi.ip_data, hdmi.edid,
                                                 HDMI_EDID_MAX_LENGTH);
@@ -250,6 +271,10 @@ u8 *hdmi_read_edid(struct omap_video_timings *dp)
                 hdmi.code = 16; /* setting default value to 1080P HDMI */
                 hdmi.mode = HDMI_HDMI;
         }
+#else
+	/*Hack for simulating EDID read in virtio*/
+	memcpy(hdmi.edid,local_edid,256);
+#endif
 	for (i = 0; i < HDMI_EDID_MAX_LENGTH; i += 16)
                pr_info("edid[%03x] = %02x %02x %02x %02x %02x %02x %02x %02x "
                         "%02x %02x %02x %02x %02x %02x %02x %02x\n", i,
-- 
1.7.1

